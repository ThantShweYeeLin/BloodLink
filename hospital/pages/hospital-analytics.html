<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analytics ‚Äî BloodLink</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f5f5; color: #111827; }
    .layout { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
    .sidebar { background: #ffffff; border-right: 1px solid #e5e7eb; padding: 1.5rem; display: flex; flex-direction: column; gap: 0.4rem; position: sticky; top: 0; height: 100vh; }
    .logo { font-weight: 700; font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem; color: #b91c1c; margin-bottom: 0.5rem; }
    .nav { display: flex; flex-direction: column; gap: 0.35rem; }
    .nav-item { display: flex; align-items: center; gap: 0.7rem; padding: 0.75rem 0.9rem; border-radius: 10px; color: #1f2937; text-decoration: none; font-weight: 600; transition: background 0.2s ease, color 0.2s ease; }
    .nav-item:hover { background: #f3f4f6; }
    .nav-item.active { background: #fef2f2; color: #b91c1c; border: 1px solid #fde8e8; }
    .main { padding: 1.5rem 2rem; }
    @media (max-width: 1024px) { .layout { grid-template-columns: 1fr; } .sidebar { position: relative; height: auto; flex-direction: row; flex-wrap: wrap; gap: 0.6rem; } .main { padding: 1rem; } }
    .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1.25rem 3rem; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; }
    .header h1 { font-size: 1.9rem; color: #111827; }
    .btn { background: #b91c1c; color: white; border: none; padding: 0.9rem 1.4rem; border-radius: 12px; font-weight: 800; cursor: pointer; box-shadow: 0 8px 18px rgba(185,28,28,0.25); }
    .btn:hover { box-shadow: 0 10px 20px rgba(185,28,28,0.28); }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem; }
    .card { background: #ffffff; border: 1px solid #e5e7eb; border-radius: 14px; padding: 1.1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .label { color: #6b7280; font-weight: 700; font-size: 0.9rem; }
    .value { font-size: 2rem; font-weight: 800; color: #111827; }
    canvas { width: 100%; height: 220px; }
    .chart-title { font-weight: 800; margin-bottom: 0.6rem; color: #111827; }
  </style>
  <link rel="stylesheet" crossorigin href="/BloodLink/assets/sidebar-toggle-BtXFaGtA.css">
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="logo">ü©∏ BloodLink</div>
      <nav class="nav">
        <a class="nav-item" href="../dashboard.html">üè† Dashboard</a>
        <a class="nav-item" href="./hospital-submit-request.html">üìù Submit Request</a>
        <a class="nav-item" href="./hospital-request-status.html">üìä Request Status</a>
        <a class="nav-item" href="./hospital-emergency-request.html">üö® Emergency</a>
        <a class="nav-item" href="./hospital-request-history.html">üïë History & Reports</a>
        <a class="nav-item" href="./hospital-notifications.html">üîî Notifications</a>
        <a class="nav-item" href="./hospital-profile.html">üë§ Profile</a>
        <a class="nav-item active" href="./hospital-analytics.html">üìà Analytics</a>
      </nav>
    </aside>
    <main class="main">
      <div class="container">
        <div class="header">
          <div>
            <h1>Analytics</h1>
            <p style="color:#6b7280; margin-top:0.3rem;">Most requested blood types, monthly consumption, emergency trends.</p>
          </div>
          <button class="btn" onclick="window.location.href='../dashboard.html'">‚Üê Dashboard</button>
        </div>

        <div class="grid" id="statGrid"></div>

        <div class="grid" style="margin-top:1rem;">
          <div class="card">
            <div class="chart-title">Most Requested Blood Types</div>
            <canvas id="chartTypes"></canvas>
          </div>
          <div class="card">
            <div class="chart-title">Monthly Consumption (units)</div>
            <canvas id="chartMonthly"></canvas>
          </div>
          <div class="card">
            <div class="chart-title">Emergency Requests Trend</div>
            <canvas id="chartEmergency"></canvas>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Lightweight canvas rendering (no external libs to keep page standalone)
    function drawBar(canvasId, labels, values, color = '#ef4444') {
      const c = document.getElementById(canvasId);
      const ctx = c.getContext('2d');
      const w = c.width = c.offsetWidth;
      const h = c.height = 220;
      ctx.clearRect(0,0,w,h);
      const max = Math.max(...values, 1);
      const barWidth = w / values.length * 0.6;
      values.forEach((v, i) => {
        const x = (i + 0.2) * (w / values.length);
        const barH = (v / max) * (h - 40);
        const y = h - barH - 20;
        ctx.fillStyle = color;
        ctx.fillRect(x, y, barWidth, barH);
        ctx.fillStyle = '#4b5563';
        ctx.font = '12px sans-serif';
        ctx.fillText(labels[i], x, h - 5);
        ctx.fillText(v, x, y - 6);
      });
    }

    function drawLine(canvasId, labels, values, color = '#22c55e') {
      const c = document.getElementById(canvasId);
      const ctx = c.getContext('2d');
      const w = c.width = c.offsetWidth;
      const h = c.height = 220;
      ctx.clearRect(0,0,w,h);
      const max = Math.max(...values, 1);
      ctx.strokeStyle = color;
      ctx.lineWidth = 3;
      ctx.beginPath();
      values.forEach((v, i) => {
        const x = (i / (values.length - 1)) * (w - 40) + 20;
        const y = h - ((v / max) * (h - 50)) - 30;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        ctx.fillStyle = '#111827';
        ctx.beginPath(); ctx.arc(x, y, 4, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = '#4b5563';
        ctx.font = '12px sans-serif';
        ctx.fillText(labels[i], x - 10, h - 8);
      });
      ctx.stroke();
    }

    function renderStats(data) {
      const grid = document.getElementById('statGrid');
      grid.innerHTML = `
        <div class="card"><div class="label">Total Requests</div><div class="value">${data.totalRequests}</div></div>
        <div class="card"><div class="label">Fulfilled Units</div><div class="value">${data.fulfilledUnits}</div></div>
        <div class="card"><div class="label">Emergency Share</div><div class="value">${data.emergencyShare}%</div></div>
        <div class="card"><div class="label">Avg Fulfillment Time</div><div class="value">${data.avgHours}h</div></div>
      `;
    }

    function loadAnalytics() {
      // Stubbed data; replace with GET /api/hospital/:id/analytics
      const sample = {
        totalRequests: 128,
        fulfilledUnits: 420,
        emergencyShare: 32,
        avgHours: 5.4,
        types: { 'O+': 140, 'A+': 90, 'B+': 70, 'AB-': 20 },
        monthly: [40, 52, 38, 60, 55, 70],
        months: ['Jan','Feb','Mar','Apr','May','Jun'],
        emergency: [3,6,4,7,5,8]
      };
      renderStats(sample);
      drawBar('chartTypes', Object.keys(sample.types), Object.values(sample.types));
      drawBar('chartMonthly', sample.months, sample.monthly, '#f97316');
      drawLine('chartEmergency', sample.months, sample.emergency, '#22c55e');
    }

    window.addEventListener('resize', loadAnalytics);
    loadAnalytics();
  </script>
  <script src="../../shared-pages/sidebar-toggle.js"></script>
</body>
</html>
